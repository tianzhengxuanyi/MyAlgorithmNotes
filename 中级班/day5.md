### 递归式从 O (N) 简化成 O (logn) 的方法

**递归需严格满足递归式**，如斐波那契数列`F(n) = F(n-1) + F(n-2)`，必须在递归的每一层中都满足递归式，不存在其他条件分支返回结果`F(n)`

#### 斐波那契数列（leetcode 剑指offer10）

**思路1（递归）：**

时间复杂度O(n)

**思路2（简化）：**

时间复杂度O(logn)

递归严格满足递归式时，递归式满足如下规律：

递归式：`F(n) = F(n-1) + F(n-2)`

$|F(3), F(2)| = |F(2), F(1)| * \left[\begin{matrix}
    a & b \\
    c & d 
\end{matrix} \right]$

$|F(4), F(3)| = |F(3), F(2)| * \left[\begin{matrix}
    a & b \\
    c & d 
\end{matrix} \right]$

$|F(5), F(4)| = |F(4), F(3)| * \left[\begin{matrix}
    a & b \\
    c & d 
\end{matrix} \right]$

$........$

$|F(n), F(n-1)| = |F(n-1), F(n-2)| * \left[\begin{matrix}
    a & b \\
    c & d 
\end{matrix} \right]$

因此可以归纳得出：

$|F(n), F(n-1)| = |F(2), F(1)| * \left[\begin{matrix}
    a & b \\
    c & d 
\end{matrix} \right]^{n-2}$

在斐波那契数列中a = 1 b = 1 c = 1 d = 0;

所以$|F(n), F(n-1)| = |1, 1| * \left[\begin{matrix}
    1 & 1 \\
    1 & 0 
\end{matrix} \right]^{n-2}$

只要求解出矩阵matrix的n-2次方就可以得出`F(n)`;

**快速求解矩阵n次方（时间复杂度O(logn)）**

假设n的二进制为1000101，初始res为单位矩阵，t = matrix；

循环n的二级制位次，每次循环t = t * t，如果n的当前位上为1则res *= t；

如上述列子n = 69，二进制位1000101，每次循环时t分别为$m$、$m^2$、$m^4$、$m^8$、$m^{16}$、$m^{32}$、$m^{64}$，n在第1、3、7位时位1，则$res=m*m^4*m^{64}=m^{69}$;

#### 推广到一般情况

递归式：$F(n) = a*F(n-1) + b*F(n-4) ... + c*F(n-m)$

可以转换成（只需要注意n减去最多的数m）：

$|F(n), F(n-1), F(n-2), F(n-3), F(n-4), ... ,F(n-m)| = |F(m), F(m-1),...F(1)|*matrix^{n-m}$，其中matrix为m*m的矩阵

**题目：**

农场中有一头母牛，每年会生下一头小母牛，小母牛三年后才能生孩子，问第n年农场有多少头母牛？（假设母牛不会死）

递归式： $F(n) = F(n-1) + F(n-3)$

**题目：**

农场中有一只母兔子，每年会生两只小母兔，小母兔需要两年才会成熟生孩子，每只兔子五年后就会死掉，问n年之后有多少只兔子？

递归式：$F(n) = F(n-1) + 2*F(n-2) - F(n-5)$