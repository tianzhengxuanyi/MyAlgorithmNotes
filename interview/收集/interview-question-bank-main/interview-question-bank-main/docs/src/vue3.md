---
lang: zh-CN
title: vue3
description: vue3é¢è¯•é¢˜
---
# vue3

## 1ã€vue3 å’Œ vue2 æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿè¯´å‡ ä¸ªä¸»è¦çš„
::: details è¯¦æƒ…
æ€§èƒ½ä¼˜åŒ–
- è™šæ‹Ÿ DOM é‡æ„ï¼šVue3çš„è™šæ‹ŸDOMé‡‡ç”¨äº†æ›´é«˜æ•ˆçš„ `Diffç®—æ³•`ï¼Œå‡å°‘äº†æ¸²æŸ“å’Œæ›´æ–°çš„å¼€é”€ã€‚
- Tree-shaking æ”¯æŒï¼šVue3çš„ä»£ç ç»“æ„æ¨¡å—åŒ–ï¼Œæ”¯æŒæŒ‰éœ€å¼•å…¥ï¼Œå‡å°äº†æ‰“åŒ…ä½“ç§¯ã€‚

Composition API
- Vue3 å¼•å…¥äº†Composition APIï¼Œä½¿ä»£ç æ›´æ¨¡å—åŒ–ã€å¤ç”¨æ€§æ›´å¼ºã€‚
- ä½¿ç”¨ `setup()` æ–¹æ³•ä»£æ›¿äº†éƒ¨åˆ†é€‰é¡¹å¼ APIï¼Œé€šè¿‡å‡½æ•°çš„æ–¹å¼ç»„ç»‡é€»è¾‘ï¼Œä»£ç æ›´åŠ æ¸…æ™°ç®€æ´ã€‚
- ç”Ÿå‘½å‘¨æœŸé’©å­åç§°å˜åŒ–ã€‚

å“åº”å¼ç³»ç»Ÿæ”¹è¿›
- Vue3 ä½¿ç”¨ `Proxy` + `Reflect` å®ç°å“åº”å¼ï¼Œè§£å†³äº† Vue2ä½¿ç”¨ Object.defineProperty å®ç°å“åº”å¼çš„ä¸€äº›å±€é™æ€§ï¼Œå¦‚æ— æ³•ç›‘å¬æ–°å¢å±æ€§å’Œæ•°ç»„ç´¢å¼•å˜åŒ–ã€‚

æ–°ç‰¹æ€§å’Œæ”¹è¿›
- Teleportï¼šå¯ä»¥å°†ç»„ä»¶çš„DOMæ¸²æŸ“åˆ°æŒ‡å®šçš„DOMèŠ‚ç‚¹ä¹‹å¤–ï¼Œä¾‹å¦‚æ¨¡æ€æ¡†ã€é€šçŸ¥ç­‰ã€‚
- Fragment æ”¯æŒï¼šVue3æ”¯æŒç»„ä»¶è¿”å›å¤šä¸ªæ ¹èŠ‚ç‚¹ï¼Œä¸å†éœ€è¦å•ä¸€æ ¹èŠ‚ç‚¹ã€‚
- Suspenseï¼šç”¨äºå¤„ç†å¼‚æ­¥ç»„ä»¶åŠ è½½ï¼Œå…è®¸åœ¨ç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­æ˜¾ç¤ºä¸€ä¸ªåŠ è½½çŠ¶æ€ï¼Œç›´åˆ°å¼‚æ­¥ç»„ä»¶åŠ è½½å®Œæˆåå†æ˜¾ç¤ºå®é™…å†…å®¹ã€‚
- Vue3 åŸç”Ÿæ”¯æŒ `TypeScript`ï¼Œæä¾›æ›´å®Œå–„çš„ç±»å‹æ¨å¯¼å’Œå¼€å‘ä½“éªŒã€‚
- Vue3 æ”¯æŒä¸ºä¸€ä¸ªç»„ä»¶ç»‘å®šå¤šä¸ª `v-model`ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰ `prop` å’Œ `event` åç§°ã€‚
- Vue3 æ”¯æŒç›‘å¬æ”¯æŒåŠ¨æ€å±æ€§ç›‘å¬å’Œæ›´å¤šæ•°æ®ç±»å‹ï¼ˆå¦‚ `Map`ã€`Set`ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ `Vue.set`ã€‚
- Vue3 æ–°å¢`provide` å’Œ `inject`æä¾›äº†æ›´çµæ´»çš„ä¾èµ–æ³¨å…¥æœºåˆ¶ã€‚
:::

## 2ã€vue3 ä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Proxyï¼Œå®ƒå¯¹æ¯” Object.defineProperty æœ‰ä»€ä¹ˆæ”¹è¿›
::: details è¯¦æƒ…
ä»¥ä¸‹æ˜¯ `Proxy` ç›¸æ¯” `Object.defineProperty` çš„ä¸€äº›æ”¹è¿›å’Œä¼˜åŠ¿ï¼š
- æ›´å¼ºå¤§å’Œçµæ´»ï¼š`Proxy` å¯ä»¥ä»£ç†æ•´ä¸ªå¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯å¯¹è±¡çš„å±æ€§ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ç›‘å¬å¯¹è±¡çš„æ•´ä¸ªæ“ä½œï¼ŒåŒ…æ‹¬å±æ€§çš„å¢åˆ æ”¹æŸ¥ç­‰ã€‚è€Œ `Object.defineProperty` åªèƒ½ç›‘å¬å¯¹è±¡çš„å±æ€§çš„è¯»å–å’Œèµ‹å€¼æ“ä½œã€‚
- æ›´ç›´è§‚å’Œæ˜“ç”¨ï¼šä½¿ç”¨ `Proxy` å¯ä»¥æ›´ç›´è§‚åœ°ç›‘å¬å¯¹è±¡çš„æ“ä½œï¼Œè€Œä¸éœ€è¦åƒ `Object.defineProperty` é‚£æ ·æ‰‹åŠ¨å®šä¹‰ getter å’Œ setterã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç†è§£ã€‚
- æ›´å¥½çš„æ€§èƒ½ï¼š`Proxy` çš„æ€§èƒ½é€šå¸¸æ¯” `Object.defineProperty` æ›´å¥½ï¼Œå› ä¸º `Proxy` æ˜¯åŸç”Ÿå®ç°çš„ï¼Œè€Œ `Object.defineProperty` æ˜¯ js å¼•æ“çš„å†…éƒ¨å®ç°ã€‚`Proxy` çš„åº•å±‚å®ç°æ›´é«˜æ•ˆï¼Œå¯ä»¥æ›´å¥½åœ°å¤„ç†å¤§å‹å¯¹è±¡å’Œå¤šæ¬¡æ“ä½œã€‚
- æ”¯æŒæ•°ç»„å˜åŒ–çš„æ£€æµ‹ï¼šä½¿ç”¨ `Proxy` å¯ä»¥å¾ˆå®¹æ˜“åœ°ç›‘å¬æ•°ç»„çš„å˜åŒ–ï¼ŒåŒ…æ‹¬æ•°ç»„çš„ pushã€popã€splice ç­‰æ“ä½œã€‚è€Œ `Object.defineProperty` éš¾ä»¥å®ç°å¯¹æ•°ç»„å˜åŒ–çš„ç›‘å¬ã€‚
:::

## 3ã€vue3 å¯¹æ¯” vue2 ç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å“ªäº›åŒºåˆ«
::: details è¯¦æƒ…
|vue2 ç”Ÿå‘½å‘¨æœŸé’©å­|vue3 Composition API é’©å­|
|----------|----------|
|`beforeCreate`|ä¸éœ€è¦ï¼ˆé€»è¾‘åœ¨ `setup` ä¸­åˆå§‹åŒ–ï¼‰|
|`created`|ä¸éœ€è¦ï¼ˆé€»è¾‘åœ¨ `setup` ä¸­åˆå§‹åŒ–ï¼‰|
|`beforeMount`|`onBeforeMount`|
|`mounted`|`onMounted`|
|`beforeUpdate`|`onBeforeUpdate`|
|`updated`|`onUpdated`|
|`beforeDestroy`|`onBeforeUnmount`|
|`destroyed`|`onUnmounted`|
|`activated`|`onActivated`|
|`deactivated`|`onDeactivated`|
|`errorCaptured`ï¼ˆ2.5.0+ æ–°å¢ï¼‰|`onErrorCaptured`|
:::

## 4ã€vue3 ä¸­ watch å’Œ watchEffect çš„åŒºåˆ«
`watch` å’Œ `watchEffect` éƒ½æ˜¯ vue3 ä¸­ç”¨äºå“åº”å¼æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå‰¯ä½œç”¨çš„ APIï¼Œå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å’Œå·¥ä½œæœºåˆ¶å­˜åœ¨åŒºåˆ«ï¼š
::: details è¯¦æƒ…
- ä¾èµ–è¿½è¸ªæ–¹å¼

`watch`ï¼šéœ€è¦æ˜¾å¼å£°æ˜ä¾èµ–ï¼Œç›‘å¬æŒ‡å®šçš„æ•°æ®æºï¼›å¯ä»¥ç›‘å¬å¤šä¸ªæ•°æ®æºæˆ–è¿›è¡Œæ·±åº¦ç›‘å¬ã€‚
```js
import { watch, reactive } from 'vue'
const state = reactive({
  count: 0,
})
watch(
  () => state.count, // æ˜¾å¼å£°æ˜ç›‘å¬çš„ä¾èµ–
  (newCount, oldCount) => {
    console.log(`æ–°å€¼ ${newCount} è€å€¼ ${oldCount}`)
  }
)
```
`watchEffect`ï¼šä¼šè‡ªåŠ¨è¿½è¸ª ä½œç”¨åŸŸå†…æ‰€æœ‰çš„å“åº”å¼ä¾èµ–ï¼Œä¸éœ€è¦æ˜¾å¼å£°æ˜ä¾èµ–ã€‚
```js
import { watchEffect, reactive } from 'vue'
const state = reactive({
  count: 0,
})
watchEffect(() => {
  console.log(`Count å˜åŒ–äº†: ${state.count}`) // è‡ªåŠ¨è¿½è¸ª `state.count`
})
```
- æ‰§è¡Œæ—¶æœº

`watch`ï¼šåœ¨ç›‘å¬çš„å“åº”å¼æ•°æ®å˜åŒ–åç«‹å³æ‰§è¡Œã€‚

`watchEffect`ï¼šåœ¨ ç»„ä»¶æŒ‚è½½æ—¶ æ‰§è¡Œä¸€æ¬¡å‰¯ä½œç”¨ï¼Œå¹¶åœ¨ ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ å†æ¬¡æ‰§è¡Œã€‚
- é€‚ç”¨åœºæ™¯

`watch`ï¼šé€‚ç”¨äº ç›‘å¬ç‰¹å®šæ•°æ® å˜åŒ–å¹¶æ‰§è¡Œå‰¯ä½œç”¨çš„åœºæ™¯ï¼Œå¦‚ API è¯·æ±‚ã€ä¿å­˜æ“ä½œç­‰ã€‚é€‚åˆéœ€è¦ è®¿é—®æ–°å€¼å’Œæ—§å€¼ è¿›è¡Œæ¯”è¾ƒçš„åœºæ™¯ã€‚

`watchEffect`ï¼šä¸éœ€è¦è®¿é—®æ—§å€¼ï¼Œé€‚ç”¨äº è‡ªåŠ¨è¿½è¸ªå¤šä¸ªå“åº”å¼ä¾èµ– çš„å‰¯ä½œç”¨ï¼Œå¦‚æ¸²æŸ“ã€è‡ªåŠ¨ä¿å­˜ç­‰ã€‚
:::

## 5ã€vue3 ä¸­ ref å’Œ reactive å¦‚ä½•é€‰æ‹©
`ref` å’Œ `reactive` éƒ½æ˜¯ vue3 ä¸­ç”¨æ¥åˆ›å»ºå“åº”å¼æ•°æ®çš„ APIï¼Œä»–ä»¬çš„åŒºåˆ«åŠä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š
::: details è¯¦æƒ…
- `ref` çš„å®ç°
  > ä¸ºäº†å®ç°åŸºæœ¬æ•°æ®ç±»å‹çš„å“åº”å¼ï¼Œvue è®¾è®¡äº† `ref`ã€‚ `ref` ä¼šå°†åŸºæœ¬æ•°æ®ç±»å‹å°è£…ä¸ºä¸€ä¸ªåŒ…å« `value` å±æ€§çš„å¯¹è±¡ï¼Œé€šè¿‡ `getter` å’Œ `setter` å®ç°å“åº”å¼ä¾èµ–è¿½è¸ªå’Œæ›´æ–°ã€‚å½“è®¿é—®æˆ–ä¿®æ”¹ `ref.value` æ—¶ï¼Œvue å†…éƒ¨ä¼šè§¦å‘ä¾èµ–æ›´æ–°ã€‚æ­¤å¤–ï¼Œå¯¹äºå¤æ‚æ•°æ®ç±»å‹ï¼ˆå¦‚å¯¹è±¡æˆ–æ•°ç»„ï¼‰ï¼Œ `ref` çš„å†…éƒ¨å®ç°ä¼šç›´æ¥è°ƒç”¨ `reactive`ï¼Œå°†å¤æ‚æ•°æ®ç±»å‹å˜ä¸ºå“åº”å¼ã€‚
- `reactive` çš„å®ç°
  > `reactive` é€šè¿‡ `Proxy` å¯¹å¯¹è±¡æˆ–æ•°ç»„çš„æ¯ä¸ªå±æ€§è¿›è¡Œæ·±åº¦ä»£ç†ï¼Œå®ç°å“åº”å¼ã€‚è¿™ç§è®¾è®¡ä½¿å¾— `reactive` èƒ½è‡ªåŠ¨è¿½è¸ªæ‰€æœ‰åµŒå¥—å±æ€§çš„å˜åŒ–ï¼Œä½†ç”±äº `Proxy` æ— æ³•ç›´æ¥å¤„ç†åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ `number` ã€ `string` ã€ `boolean` ï¼‰ï¼Œå› æ­¤ï¼Œ `reactive` ä¸é€‚ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ã€‚
::: tip å¦‚ä½•é€‰æ‹©
å®˜æ–¹å»ºè®®ä½¿ç”¨ `ref()` ä½œä¸ºå£°æ˜å“åº”å¼çŠ¶æ€çš„ä¸»è¦ APIï¼ˆ[å“åº”å¼åŸºç¡€](https://cn.vuejs.org/guide/essentials/reactivity-fundamentals.html#why-refs)ï¼‰ï¼Œå› ä¸º `reactive` å­˜åœ¨ä»¥ä¸‹å±€é™æ€§ï¼š

ğŸ’¡æœ‰é™çš„å€¼ç±»å‹ï¼šå®ƒåªèƒ½ç”¨äºå¯¹è±¡ç±»å‹ (å¯¹è±¡ã€æ•°ç»„å’Œå¦‚ `Map`ã€`Set` è¿™æ ·çš„é›†åˆç±»å‹)ã€‚å®ƒä¸èƒ½æŒæœ‰å¦‚ `string`ã€`number` æˆ– `boolean` è¿™æ ·çš„åŸå§‹ç±»å‹ã€‚ 

ğŸ’¡ä¸èƒ½æ›¿æ¢æ•´ä¸ªå¯¹è±¡ï¼šç”±äº Vue çš„å“åº”å¼è·Ÿè¸ªæ˜¯é€šè¿‡å±æ€§è®¿é—®å®ç°çš„ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å§‹ç»ˆä¿æŒå¯¹å“åº”å¼å¯¹è±¡çš„ç›¸åŒå¼•ç”¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½è½»æ˜“åœ°â€œæ›¿æ¢â€å“åº”å¼å¯¹è±¡ï¼Œå› ä¸ºè¿™æ ·çš„è¯ä¸ç¬¬ä¸€ä¸ªå¼•ç”¨çš„å“åº”æ€§è¿æ¥å°†ä¸¢å¤±ï¼š
```js
let state = reactive({
  count: 0,
})

// ä¸Šé¢çš„ ({ count: 0 }) å¼•ç”¨å°†ä¸å†è¢«è¿½è¸ª
// (å“åº”æ€§è¿æ¥å·²ä¸¢å¤±ï¼)
state = reactive({
  count: 1,
})
```
ğŸ’¡å¯¹è§£æ„æ“ä½œä¸å‹å¥½ï¼šå½“æˆ‘ä»¬å°†å“åº”å¼å¯¹è±¡çš„åŸå§‹ç±»å‹å±æ€§è§£æ„ä¸ºæœ¬åœ°å˜é‡æ—¶ï¼Œæˆ–è€…å°†è¯¥å±æ€§ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±å“åº”æ€§è¿æ¥
```js
const state = reactive({
  count: 0,
})
// å½“è§£æ„æ—¶ï¼Œcount å·²ç»ä¸ state.count æ–­å¼€è¿æ¥
let { count } = state
// ä¸ä¼šå½±å“åŸå§‹çš„ state
count++

// è¯¥å‡½æ•°æ¥æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°å­—
// å¹¶ä¸”æ— æ³•è¿½è¸ª state.count çš„å˜åŒ–
// æˆ‘ä»¬å¿…é¡»ä¼ å…¥æ•´ä¸ªå¯¹è±¡ä»¥ä¿æŒå“åº”æ€§
callSomeFunction(state.count)
```
:::

## 6ã€vue3 ä¸­ ä½•ç»Ÿä¸€ç›‘å¬ç»„ä»¶æŠ¥é”™
::: details è¯¦æƒ…
åœ¨ vue3 ä¸­ï¼Œå¯ä»¥é€šè¿‡ å…¨å±€é”™è¯¯å¤„ç†å™¨ ï¼ˆ`errorHandler`ï¼‰ å’Œ ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆä¾‹å¦‚ `onErrorCaptured` ï¼‰æ¥ç»Ÿä¸€ç›‘å¬å’Œå¤„ç†ç»„ä»¶ä¸­çš„é”™è¯¯ã€‚
- é€šè¿‡å…¨å±€é”™è¯¯å¤„ç†å™¨ `app.config.errorHandler`
```js
import { createApp } from 'vue';
const app = createApp(App);
// è®¾ç½®å…¨å±€é”™è¯¯å¤„ç†å™¨
app.config.errorHandler = (err, instance, info) => {
  console.error('æ•è·åˆ°ç»„ä»¶é”™è¯¯: ', err);
  console.log('å‘ç”Ÿé”™è¯¯çš„ç»„ä»¶å®ä¾‹: ', instance);
  console.log('é”™è¯¯ä¿¡æ¯: ', info);
};

app.mount('#app');
```
- é€šè¿‡ç”Ÿå‘½å‘¨æœŸé’©å­ `onErrorCaptured` å±€éƒ¨æ•è·é”™è¯¯
```vue
<template>
  <div>
    <h2>å±€éƒ¨é”™è¯¯æ•è·ç¤ºä¾‹</h2>
    <ErrorProneComponent />
  </div>
</template>

<script setup>
import { onErrorCaptured } from 'vue'

onErrorCaptured((err, instance, info) => {
  console.error('å±€éƒ¨æ•è·åˆ°é”™è¯¯: ', err)
  console.log('é”™è¯¯æ¥æºç»„ä»¶: ', instance)
  console.log('é”™è¯¯ä¿¡æ¯: ', info)

  // è¿™ä¸ªé’©å­å¯ä»¥é€šè¿‡è¿”å› false æ¥é˜»æ­¢é”™è¯¯ç»§ç»­å‘ä¸Šä¼ é€’ã€‚
  return false // å¦‚æœéœ€è¦è®©é”™è¯¯å†’æ³¡åˆ°å…¨å±€ï¼Œçœç•¥æˆ–è¿”å› true
})
</script>
```
:::

## 7ã€ä½¿ç”¨ Vue3 Composable ç»„åˆå¼å‡½æ•°ï¼Œå®ç° useCount
::: tip æç¤º
åœ¨ Vue åº”ç”¨çš„æ¦‚å¿µä¸­ï¼Œâ€œç»„åˆå¼å‡½æ•°â€(Composables) æ˜¯ä¸€ä¸ªåˆ©ç”¨ Vue çš„ç»„åˆå¼ API æ¥å°è£…å’Œå¤ç”¨æœ‰çŠ¶æ€é€»è¾‘çš„å‡½æ•°ã€‚å®ƒå’Œè‡ªå®šä¹‰ `React hooks` éå¸¸ç›¸ä¼¼ã€‚
:::
::: details è¯¦æƒ…
ä½¿ç”¨ç»„åˆå¼å‡½æ•°å®ç°å¦‚ä¸‹éœ€æ±‚ï¼šuseCount æ˜¯ä¸€ä¸ªè®¡æ•°é€»è¾‘ç®¡ç†çš„ç»„åˆå¼å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ª count å˜é‡å’Œå¢åŠ ã€å‡å°‘ã€é‡ç½®countçš„æ–¹æ³•ã€‚
```vue
<template>
  <div>
    <h2>è®¡æ•°å™¨: {{ count }}</h2>
    <button @click="increment">å¢åŠ </button>
    <button @click="decrement">å‡å°‘</button>
    <button @click="reset">é‡ç½®</button>
  </div>
</template>

<script setup>
import { ref } from 'vue'

// å®ç° useCount ç»„åˆå¼å‡½æ•°
function useCount() {
  const count = ref(0)
  const increment = () => {
    count.value++
  }
  const decrement = () => {
    count.value--
  }
  const reset = () => {
    count.value = 0
  }
  return {
    count,
    increment,
    decrement,
    reset,
  }
}

// ä½¿ç”¨ useCount ç»„åˆå¼å‡½æ•°
const { count, increment, decrement, reset } = useCount()
</script>
```
:::

## 8ã€vue3 ä¸­ å¦‚ä½•ä½¿ç”¨ `v-memo` æŒ‡ä»¤ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½
`v-memo` æ˜¯ Vue 3.2 å¼•å…¥çš„æŒ‡ä»¤ï¼Œç”¨äºæœ‰æ¡ä»¶åœ°ç¼“å­˜å­æ ‘çš„æ¸²æŸ“ç»“æœï¼Œä»…åœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ã€‚
::: details è¯¦æƒ…
```vue
<template>
  <div v-memo="[valueA, valueB]">
    <!-- ä»…åœ¨ valueA æˆ– valueB å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ -->
    <ChildComponent :a="valueA" :b="valueB" />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import ChildComponent from './ChildComponent.vue';

const valueA = ref(1);
const valueB = ref(2);
</script>
```
::: tip æç¤º
`v-memo` ä»…ç”¨äºæ€§èƒ½è‡³ä¸Šåœºæ™¯ä¸­çš„å¾®å°ä¼˜åŒ–ï¼Œåº”è¯¥å¾ˆå°‘éœ€è¦ã€‚æœ€å¸¸è§çš„æƒ…å†µå¯èƒ½æ˜¯æœ‰åŠ©äºæ¸²æŸ“æµ·é‡ `v-for` åˆ—è¡¨ (é•¿åº¦è¶…è¿‡ 1000 çš„æƒ…å†µ)ã€‚
:::