#!/bin/sh

if ! type node >/dev/null 2>&1; then
  echo 'node æœªå®‰è£…'
  if [ -d "$HOME/.nvm" ]; then
    echo "æœ‰ .nvm è¿™ä¸ªç›®å½•"

    export NVM_DIR="$HOME/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

    matchNvmUseNodeVersion=$(nvm current)
    if [ "$matchNvmUseNodeVersion" == "none" ]; then
      echo "æ²¡æœ‰æ‰¾åˆ° nvm è®¾ç½®çš„ Node ç‰ˆæœ¬,è¯·æ‰§è¡Œ nvm install --lts"
      exit 1
    else
      echo "æ£€æµ‹åˆ° nvm è®¾ç½®äº†æœ‰æ•ˆçš„ Node ç‰ˆæœ¬: $matchNvmUseNodeVersion"
      export PATH="$NVM_DIR/versions/node/$matchNvmUseNodeVersion/bin:$PATH"
    fi
  fi

else
  echo 'node å·²å®‰è£…'
  nodeVersion=$(node -v)
  npmVersion=$(npm -v)
  echo "âœ… node ç‰ˆæœ¬:$nodeVersion"
  echo $(which node)
  echo "âœ… npm ç‰ˆæœ¬:$npmVersion"
  echo $(which npm)
fi

# æ‰§è¡Œ lint-staged (è¿™é‡Œä¸éœ€è¦ lint-staged,å› ä¸ºè¿™æ˜¯ä»¥ .md æ–‡ä»¶ä¸ºä¸»)
# echo "ğŸš€ æ­£åœ¨æ‰§è¡Œ lint-staged..."
# npx lint-staged --verbose

# æ‰§è¡Œ commitlint
echo "ğŸš€ æ­£åœ¨æ‰§è¡Œ commitlint..."
npx --no -- commitlint --edit "$1"
